<!-- ==========================================================
     COMPONENTE ¬´RESUMEN DE LA ESTIMACI√ìN¬ª ‚Äï Smart3Z
     Descripci√≥n:
     - Tarjeta que muestra el resultado de la estimaci√≥n
       de costes y horas por perfil.
     - Incluye desglose costo base / social y un bot√≥n para
       persistir la estimaci√≥n.
     - Se oculta el contenido si no hay datos (ngIf).
     ========================================================== -->

<ion-card>

  <!-- ---------- CABECERA ---------- -->
  <ion-card-header>
    <ion-card-title>Resumen de la Estimaci√≥n</ion-card-title>
  </ion-card-header>

  <!-- ---------- CUERPO ---------- *
   *  ‚Ä¢ *ngIf verifica que existan resultados.
   *  ‚Ä¢ resultadoPorPerfil es un array generado en el componente TS.
   -->
  <ion-card-content *ngIf="resultadoPorPerfil.length">

    <!-- Total global de horas -->
    <p>
      <strong>Total de horas del proyecto:</strong>
      {{ totalHoras }}
    </p>

    <!-- ===== LISTA DE PERFILES ===== -->
    <ion-list>
      <!-- ng-container evita generar nodos extra en el DOM -->
      <ng-container *ngFor="let r of resultadoPorPerfil">
        <ion-item>
          <ion-label class="ion-text-wrap">

            <!-- Nombre del perfil -->
            <h2>{{ r.nombre }}</h2>

            <!-- Detalles de la estimaci√≥n -->
            <p>Horas necesarias: {{ r.horas }}</p>
            <p>Plantilla m√≠nima requerida: {{ r.plantillaFinal }}</p>

            <!-- Coste total para este perfil -->
            <p>
              üí∞ <strong>Coste estimado total:</strong>
              {{ r.coste | currency:'EUR':'symbol':'1.2-2' }}
            </p>

            <!-- Desglose coste base + social -->
            <p class="ion-text-wrap" style="margin-left: 1em;">
              ‚ñ™Ô∏è Coste base&nbsp;(horas √ó tarifa):
              {{
                (r.coste / (1 + calendario.socialRate / 100))
                  | currency:'EUR':'symbol':'1.2-2'
              }}<br />
              ‚ñ™Ô∏è Coste social&nbsp;(%):
              {{
                (r.coste * calendario.socialRate /
                  (100 + calendario.socialRate))
                  | currency:'EUR':'symbol':'1.2-2'
              }}
            </p>

            <!-- Chip de capacidad -->
            <ion-chip [color]="r.hayCapacidad ? 'success' : 'danger'">
              <ion-icon
                slot="start"
                [name]="
                  r.hayCapacidad
                    ? 'checkmark-circle-outline'
                    : 'close-circle-outline'
                ">
              </ion-icon>
              <ion-label>
                {{
                  r.hayCapacidad
                    ? 'Capacidad suficiente'
                    : 'Capacidad insuficiente'
                }}
              </ion-label>
            </ion-chip>
          </ion-label>
        </ion-item>
      </ng-container>
    </ion-list>

    <!-- Coste total de la estimaci√≥n -->
    <ion-note color="primary">
      <strong>Coste total estimado: </strong>
      {{ costeTotal | currency:'EUR':'symbol':'1.2-2' }}
    </ion-note>

    <!-- Bot√≥n para guardar la estimaci√≥n -->
    <ion-button
      expand="block"
      color="success"
      (click)="guardar()">
      <ion-icon slot="start" name="save-outline"></ion-icon>
      Guardar estimaci√≥n
    </ion-button>

  </ion-card-content>
</ion-card>
